<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title><%= title %></title>

    <% if( bikesledStyles ) { %>
        <%= styles %>
    <% } %>

    <% if( stylesheets ) { %>
        <% stylesheets.forEach( ( stylesheet ) => { %>
            <link rel="stylesheet" href="<%= stylesheet.split( '/' ).pop() %>">
        <% } ); %>
    <% } %>

    <% if( scripts ) { %>
        <% scripts.forEach( ( scriptSrc ) => { %>
            <script src="<%= scriptSrc.split( '/' ).pop() %>" charset="utf-8"></script>
        <% } ); %>
    <% } %>


    <% if( mockRequests ) { %>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sinon.js/1.15.4/sinon.min.js" charset="utf-8"></script>
        <script type="text/javascript">
            window.bikesled = {};

            window.bikesled.server = sinon.fakeServer.create();
        </script>
    <% } %>
</head>
<body>
    <% if( bikesledStyles ){ %>
        <nav id="bikesled-header">
            <h4 class="bikesled-component-menu">menu</h4>
            <h3 class="bikesled-title"><%= title %></h3>
        </nav>
        <div id="bikesled-sidebar">
            <ul>
                <% names.forEach( ( name ) => { %>
                    <li><%= name %></li>
                <% } ); %>
            </ul>
        </div>
    <% } %>

    <div id="bikesled-container">
        <%= rendered %>
    </div>

    <script src="bundle.js" charset="utf-8"></script>

    <% if( bikesledStyles ){ %>
        <script type="text/javascript">
            var componentMenuTrigger = document.querySelector( "#bikesled-header .bikesled-component-menu" );
            var componentMenu = document.getElementById( "bikesled-sidebar" );
            var container = document.getElementById( "bikesled-container" );
            var componentMenuItems = document.querySelectorAll( "#bikesled-sidebar li" );
            var componentWrappers = document.querySelectorAll( ".bikesled-component-wrapper" );
            var componentArray = Array.from( componentWrappers );

            var menuDictionary = Array
                .from( componentMenuItems )
                .reduce(
                    ( acc, menuItem ) => {
                        var name = menuItem.textContent;
                        var kebabName = kebabCase( name );
                        var target = componentArray.filter(
                            ( section ) => section.dataset.bikesled === kebabName
                        )[0];

                        acc[ kebabName ] = {
                            "name": name,
                            "menuItem": menuItem,
                            "target": target
                        };

                        return acc;
                    },
                    {}
                );

            function kebabCase( str ){
                return str
                    .replace( /\s/g, "-" )
                    .toLowerCase()
            }

            function scrollToComponent( name ){
                var kebabName = kebabCase( name );
                var target = menuDictionary[ kebabName ].target;
                var offsetY = target ? target.offsetTop - 120 : 0;

                window.scrollTo( 0, offsetY );
            }

            function toggleComponentMenu(){
                componentMenu.classList.toggle( "active" );
                container.classList.toggle( "active" );
            }

            function activateMenuItems( target ){
                componentMenuItems.forEach(
                    ( item ) => item.classList.remove( "active" )
                );

                target.classList.add( "active" );
            }

            componentMenuTrigger.addEventListener(
                "click",
                toggleComponentMenu
            );

            componentMenuItems.forEach(
                ( item ) => item.addEventListener(
                    "click",
                    ( event ) => {
                        activateMenuItems( event.target );
                        scrollToComponent( event.target.textContent );
                    }
                )
            );

            componentWrappers.forEach(
                ( component ) => component.addEventListener(
                    "mouseenter",
                    ( event ) => {
                        var itemReference = event.target.dataset.bikesled;
                        var menuItem = menuDictionary[ itemReference ].menuItem;

                        activateMenuItems( menuItem );
                    }
                )
            );
        </script>
    <% } %>
</body>
</html>
